# Command Center v3.0 â€” Project Memory System

## Overview

Transform the Kanban board from a task tracker into a **living project workspace** where each card is a mini knowledge base with documents, comments, and history that Watson can read and act on.

---

## Current Architecture (v2.3)

```
command-center/
  index.html        â† Single-file PWA (all HTML/CSS/JS)
  state.json        â† Static system data (agents, costs, pipeline, feed)
  manifest.json     â† PWA manifest
  sw.js             â† Service worker
```

- **Tasks** live in `localStorage` only â€” Watson can't see them
- **state.json** is manually updated â€” no live data pipeline
- No file attachments, no comment threads, no per-card history

**Core problem:** Paul's task data is trapped in the browser. Watson is blind to it.

---

## v3.0 Architecture

```
command-center/
  index.html        â† PWA (enhanced with card detail panel, comments, attachments)
  state.json        â† System state â€” auto-generated by sync script
  board.json        â† Task/card data â€” the single source of truth
  cards/            â† Per-card document storage
    {card-uuid}/
      README.md     â† Optional long-form notes
      *.md          â† Attached documents (PRs, specs, briefs)
  scripts/
    sync.sh         â† Cron-driven state sync (no AI, no API costs)
```

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Paul's     â”‚       â”‚   GitHub     â”‚       â”‚  Watson     â”‚
â”‚  Browser    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚   Repo       â”‚â—€â”€â”€â”€â”€â”€â”€â”‚  (filesystemâ”‚
â”‚  (PWA)      â”‚ write â”‚  board.json  â”‚ read  â”‚   access)   â”‚
â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”‚  cards/*     â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
â”‚             â”‚  read â”‚  state.json  â”‚ write â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ auto-push
                      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                      â”‚  sync.sh   â”‚
                      â”‚  (cron)    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key insight:** The GitHub repo IS the database. Both Paul (via browser) and Watson (via filesystem) read and write to it. The sync script keeps system data fresh.

---

## Feature 1: State Sync Script

**Zero API cost.** Pure shell + jq. Runs every 5 minutes via launchd.

### What it collects:
| Source | Data | How |
|--------|------|-----|
| OpenClaw config | Agent status, current model | Read `openclaw.json` |
| OpenClaw logs | Recent activity, session count | Parse log files |
| Git repos | Commit counts, last activity, branch status | `git log`, `git status` |
| System | Uptime, disk, memory | `uptime`, `df`, `vm_stat` |
| CoachFinder | Pipeline status, DB counts | Read Python configs / DB |
| Cost tracking | Token usage from OpenClaw logs | Parse session logs |

### Output:
Writes `state.json` with fresh data, commits, and pushes. The PWA's 60-second auto-refresh picks it up.

### Schedule:
- Every 5 minutes during active hours (8amâ€“11pm EST)
- Every 30 minutes overnight
- Immediate run on git push (post-commit hook)

---

## Feature 2: Card Detail Panel

When Paul taps a card, instead of the current edit modal, a **detail panel** slides in with:

### Layout (Mobile-First)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Back            CoachFinder    â”‚  â† project badge
â”‚                                  â”‚
â”‚ â–ˆâ–ˆ CoachFinder Pipeline          â”‚  â† title (editable)
â”‚ ğŸ¤– Codex Â· high Â· est $3.40     â”‚  â† metadata chips
â”‚ Status: Active   Due: Feb 15    â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Notes                    âœï¸  â”‚ â”‚  â† rich notes (markdown)
â”‚ â”‚ Integration pipeline needs   â”‚ â”‚
â”‚ â”‚ to handle rate limiting...   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ ğŸ“ Attachments                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ â”‚PR.md â”‚ â”‚spec  â”‚  + Upload     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                  â”‚
â”‚ ğŸ’¬ Comments (3)                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Paul Â· 2h ago                â”‚ â”‚
â”‚ â”‚ Watson, pivot this to v2 API â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ” Watson Â· 1h ago          â”‚ â”‚
â”‚ â”‚ Done. Updated endpoint in    â”‚ â”‚
â”‚ â”‚ extractor.py. See PR #42.   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Paul Â· 30m ago               â”‚ â”‚
â”‚ â”‚ Perfect. Move to Done.       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ [ Add comment...          Send ] â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“œ History                 â”‚   â”‚
â”‚ â”‚ Created Feb 8 Â· 3 edits    â”‚   â”‚
â”‚ â”‚ Last updated 30m ago       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚
â”‚      [ Edit ]  [ Delete ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tabs within card detail:
1. **Overview** â€” metadata, notes, status (default view)
2. **Files** â€” attached documents with markdown preview
3. **Comments** â€” threaded discussion
4. **History** â€” change log (auto-tracked)

---

## Feature 3: Per-Card Documents

### Upload flow:
1. Paul taps "+ Upload" in card detail
2. File picker opens (accepts `.md`, `.txt`, `.json`, `.csv`, `.pdf`)
3. File is committed to `cards/{card-uuid}/{filename}`
4. Card's attachment list updates
5. Markdown files render inline with preview

### Watson's access:
Watson reads `cards/` directly from filesystem. When Paul uploads a PR review or spec, Watson sees it immediately on next heartbeat or when asked.

### Storage:
- Markdown/text files stored as-is in `cards/{uuid}/`
- Binary files (images, PDFs) stored with git LFS or base64 in JSON (size limit: 1MB per file, 5MB per card)

---

## Feature 4: Comment System

### Data structure (in board.json):
```json
{
  "id": "uuid-here",
  "title": "CoachFinder Pipeline",
  "comments": [
    {
      "id": "comment-uuid",
      "author": "paul",
      "authorLabel": "Paul",
      "text": "Watson, pivot this to v2 API",
      "timestamp": "2026-02-10T08:30:00-05:00"
    },
    {
      "id": "comment-uuid-2",
      "author": "watson",
      "authorLabel": "ğŸ” Watson",
      "text": "Done. Updated endpoint in extractor.py. See PR #42.",
      "timestamp": "2026-02-10T09:15:00-05:00"
    }
  ]
}
```

### How Watson reads/responds:
1. During heartbeats, Watson scans `board.json` for new comments addressed to him
2. Watson can respond by editing `board.json` and pushing
3. Watson can also act on comments â€” move cards, update status, kick off Codex, etc.
4. Comments are the **conversation layer** between Paul and Watson about specific tasks

### How Paul comments:
- Type in the comment box in card detail â†’ saved to `board.json` via GitHub API
- Or message Watson on Telegram: "Add a comment to CoachFinder card: ..." â†’ Watson writes it

---

## Feature 5: GitHub API Integration (Browser Writes)

The PWA needs to write back to the repo. Since there's no backend, we use the GitHub API directly from the browser.

### Setup (one-time):
1. Paul creates a GitHub Personal Access Token (fine-grained, repo-scoped to `command-center`)
2. Enters it in the PWA settings â†’ stored in localStorage (never leaves the browser)
3. PWA uses `https://api.github.com/repos/watson-pierbras/command-center/contents/...` for reads/writes

### Operations:
| Action | API Call |
|--------|----------|
| Save card edits | PUT `board.json` |
| Add comment | PUT `board.json` (append to comments array) |
| Upload file | PUT `cards/{uuid}/{filename}` |
| Delete file | DELETE `cards/{uuid}/{filename}` |

### Fallback:
If no GitHub token configured, the PWA works in **read-only mode** with localStorage as scratch. Paul can still message Watson on Telegram to make changes.

---

## board.json Schema

```json
{
  "version": "3.0",
  "lastModified": "2026-02-10T09:00:00-05:00",
  "modifiedBy": "paul",
  "tasks": [
    {
      "id": "uuid",
      "title": "CoachFinder Pipeline Integration",
      "column": "active",
      "priority": "high",
      "project": "CoachFinder",
      "assignedAgent": "codex",
      "model": "gpt-5.3-codex",
      "estimatedTime": "1w",
      "estimatedCost": 3.40,
      "dueDate": "2026-02-15",
      "notes": "Full pipeline: scraper â†’ discovery â†’ extractor â†’ HubSpot.\nNeeds rate limiting on school lookups.",
      "attachments": [
        { "filename": "pipeline-spec.md", "addedBy": "paul", "addedAt": "2026-02-10T08:00:00-05:00" }
      ],
      "comments": [
        {
          "id": "c1",
          "author": "paul",
          "text": "Watson, pivot this to v2 API",
          "timestamp": "2026-02-10T08:30:00-05:00"
        }
      ],
      "history": [
        { "action": "created", "by": "paul", "at": "2026-02-08T18:00:00-05:00" },
        { "action": "moved", "from": "planned", "to": "active", "by": "watson", "at": "2026-02-09T10:00:00-05:00" }
      ],
      "createdAt": "2026-02-08T18:00:00-05:00",
      "completedAt": null
    }
  ]
}
```

---

## Migration Plan (v2.3 â†’ v3.0)

1. **Export existing tasks** from localStorage â†’ seed `board.json`
2. **Create `cards/` folder** structure
3. **Migrate task data** â€” existing notes field becomes the notes field, no comments yet
4. **Keep state.json separate** â€” system data stays auto-generated
5. **PWA loads from board.json** instead of localStorage (with localStorage as offline cache)
6. **Version bump** all references to v3.0

---

## Implementation Phases

### Phase 1: Foundation (~2h Codex session)
- [ ] Create `board.json` schema and seed with current tasks
- [ ] Sync script (`scripts/sync.sh`) â€” system state collection + auto-push
- [ ] Launchd plist for 5-minute scheduling
- [ ] PWA reads tasks from `board.json` instead of localStorage
- [ ] Keep localStorage as offline fallback/cache

### Phase 2: Card Detail Panel (~2h Codex session)
- [ ] Replace edit modal with full card detail panel (slide-in)
- [ ] Metadata display + inline editing
- [ ] Rich notes with markdown rendering
- [ ] Comment thread display
- [ ] Comment input box
- [ ] Card history timeline

### Phase 3: GitHub API Writes (~1.5h Codex session)
- [ ] Settings panel for GitHub PAT entry
- [ ] Write-back for card edits (board.json)
- [ ] Write-back for new comments
- [ ] File upload to `cards/{uuid}/`
- [ ] Conflict detection (compare SHA before write)
- [ ] Read-only fallback when no token

### Phase 4: Watson Integration (~1h Watson config)
- [ ] Heartbeat check: scan board.json for new comments mentioning Watson
- [ ] Watson can respond to comments by editing board.json
- [ ] Watson can update card status based on comment instructions
- [ ] Telegram bridge: "comment on X card" â†’ Watson writes to board.json

---

## Cost Estimate

| Phase | Agent | Model | Est. Time | Est. Cost |
|-------|-------|-------|-----------|-----------|
| Phase 1 | Codex | gpt-5.3-codex | 2h | ~$0.80 |
| Phase 2 | Codex | gpt-5.3-codex | 2h | ~$0.80 |
| Phase 3 | Codex | gpt-5.3-codex | 1.5h | ~$0.60 |
| Phase 4 | Watson | claude-opus-4-6 | 1h | ~$0.50 |
| **Total** | | | **~6.5h** | **~$2.70** |

Zero ongoing API cost for the sync script â€” it's pure shell.

---

## Open Questions for Paul

1. **GitHub token**: Comfortable storing a PAT in the browser, or prefer Watson-only writes (you comment via Telegram)?
2. **File types**: Just markdown, or also images/PDFs? (Images add complexity)
3. **Phase priority**: Start with Phase 1 (sync + data foundation) or jump to Phase 2 (card detail UI)?
4. **Offline**: Important that it works offline, or always-connected is fine?
